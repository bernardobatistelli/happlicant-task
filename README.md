# Happlicant Task - Companies Management Dashboard

**Deployed Application:** https://happlicant-task-ten.vercel.app/

**Design System:** https://www.figma.com/design/7eMd6cnpkP3cEUIXaDVOXJ/Untitled?node-id=0-1&m=dev
** The figma prototype was generated by Figma Make (AI tool by Figma)

## âœ¨ Key Features

- **Full CRUD Operations** - Create, read, update, and delete companies
- **Advanced Filtering** - Search by name/description and filter by industry
- **Responsive Design** - Mobile-first approach with shadcn/ui components
- **Optimistic UI Updates** - Instant feedback with automatic rollback on errors
- **Server-Side Rendering** - Fast initial page loads with SSR
- **Next.16 use Cache** - Real usage of the new Next.js directive for caching
- **Type-Safe** - Full TypeScript implementation with Zod validation

## ğŸ› ï¸ Technology Stack

### Core Framework
- **Next.js 16** - Latest version with App Router and enhanced caching
- **React 19** - Latest React with new hooks and concurrent features
- **TypeScript** - Full type safety across the application

### Database & ORM
- **PostgreSQL** - Robust relational database
- **Prisma** - Type-safe database client with migrations

### UI & Styling
- **shadcn/ui** - High-quality, accessible component library
- **Tailwind CSS v4** - Utility-first CSS framework
- **Lucide React** - Beautiful icon library

### State Management & Forms
- **React Hook Form** - Performant form validation
- **Zod** - TypeScript-first schema validation
- **nuqs** - Type-safe URL search params management

## ğŸ¯ Implementation Highlights

### 1. Next.js 16 `"use cache"` Directive

The project leverages Next.js 16's new caching system with the `"use cache"` directive and granular cache invalidation:

```typescript
// src/http/companies.ts
export async function getCompanies(filters?: {
  search?: string;
  industry?: string;
}): Promise<Company[]> {
  "use cache";  // âœ¨ Next.js 16 cache directive
  cacheTag(CACHE_TAGS.companies);
  
  const dbCompanies = await findAllCompanies(filters);
  return dbCompanies.map(prismaToCompany);
}
```

Cache invalidation is handled precisely using `updateTag()`:

```typescript
// src/actions/companies.ts
export async function createCompanyAction(prevState, formData) {
  // ... validation and creation logic
  
  updateTag(CACHE_TAGS.companies);  // Invalidate companies list cache
  
  return { success: true, data: newCompany };
}
```

### 2. React 19 `useOptimistic` Hook

Provides instant UI feedback while server actions are processing:

```typescript
// src/components/pages/dashboard/companies/hooks/use-company-actions.ts
const [optimisticCompanies, updateOptimistic] = useOptimistic(
  companies,
  (state, action) => {
    if (action.type === "delete") {
      return state.filter((c) => c.id !== action.id);
    } else if (action.type === "update") {
      return state.map((c) =>
        c.id === action.company.id ? action.company : c
      );
    } else {
      return [action.company, ...state];
    }
  }
);

const handleDeleteConfirm = async (company: Company) => {
  startActionTransition(async () => {
    // Update UI optimistically
    updateOptimistic({ type: "delete", id: company.id });
    
    // Perform actual deletion
    const result = await deleteCompanyAction(company.id);
    
    // Show feedback
    if (result.success) {
      toast.success(result.message);
    }
  });
};
```

### 3. React 19 `useTransition` Hook

Manages async state transitions without blocking the UI:

```typescript
// Used across dialogs and action handlers
const [isPending, startTransition] = useTransition();

const handleSubmit = (data: FormData) => {
  startTransition(async () => {
    const result = await createCompanyAction(null, data);
    // UI remains responsive during action execution
  });
};
```

### 4. Server-Side Rendering (SSR)

The application uses React Server Components and Suspense for optimal performance:

```typescript
// src/app/(dashboard)/home/page.tsx
export default function DashboardPage({ searchParams }: PageProps) {
  return (
    <Container>
      <Suspense fallback={<CompaniesListSkeleton />}>
        <CompaniesSection searchParams={searchParams} />
      </Suspense>
    </Container>
  );
}

// src/components/pages/dashboard/companies/companies-section.tsx
export async function CompaniesSection({ searchParams }: Props) {
  // This is a Server Component - data fetched on the server
  const { page, itemsPerPage, search, industry } = 
    await companiesSearchParamsCache.parse(searchParams);
  
  const companies = await getCompanies({ search, industry });
  
  return <CompaniesPaginatedList companies={companies} />;
}
```

**Benefits:**
- âœ… Faster initial page load (HTML sent from server)
- âœ… Better SEO (content visible to crawlers)
- âœ… Reduced client-side JavaScript bundle
- âœ… Data fetching happens server-side (closer to database)

### 5. Server Actions

All mutations are handled through type-safe server actions:

```typescript
// src/actions/companies.ts
"use server";

export async function createCompanyAction(
  prevState: FormActionState | null,
  formData: FormData
): Promise<FormActionState> {
  // Validation with Zod
  const validatedFields = companySchema.safeParse(rawData);
  
  if (!validatedFields.success) {
    return {
      success: false,
      message: "Validation failed",
      errors: validatedFields.error.flatten().fieldErrors,
    };
  }
  
  // Database operation
  const newCompany = await createCompany(validatedFields.data);
  
  // Cache invalidation
  updateTag(CACHE_TAGS.companies);
  
  return { success: true, data: newCompany };
}
```

## ğŸ“ Project Structure

```
src/
â”œâ”€â”€ actions/          # Server actions for mutations
â”œâ”€â”€ app/             # Next.js App Router pages
â”‚   â””â”€â”€ (dashboard)/ # Dashboard layout group
â”‚       â””â”€â”€ home/    # Companies listing page
â”œâ”€â”€ components/      # React components
â”‚   â”œâ”€â”€ dialogs/     # Modal dialogs for CRUD operations
â”‚   â”œâ”€â”€ pages/       # Page-specific components
â”‚   â””â”€â”€ ui/          # shadcn/ui component library
â”œâ”€â”€ hooks/           # Custom React hooks
â”œâ”€â”€ http/            # API layer with caching
â”œâ”€â”€ lib/             # Utilities and shared logic
â”‚   â”œâ”€â”€ validations/ # Zod schemas
â”‚   â”œâ”€â”€ cache-tags.ts
â”‚   â”œâ”€â”€ company-repository.ts
â”‚   â””â”€â”€ db.ts        # Prisma client
â”œâ”€â”€ styles/          # Global styles
â””â”€â”€ types/           # TypeScript type definitions
```

## ğŸš¦ Getting Started

### Prerequisites

- Node.js 18+ and npm
- PostgreSQL database
- Git

### Installation

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd happlicant-task
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Set up environment variables**
   
   Create a `.env` file in the root directory:
   ```env
   DATABASE_URL="postgresql://user:password@localhost:5432/happlicant"
   ```

4. **Run database migrations**
   ```bash
   npx prisma migrate dev
   ```

5. **Seed the database (optional)**
   ```bash
   npm run db:seed
   ```

6. **Generate Prisma Client**
   ```bash
   npx prisma generate
   ```

7. **Start the development server**
   ```bash
   npm run dev
   ```

8. **Open your browser**
   
   Navigate to [http://localhost:3000](http://localhost:3000)

### Using Docker

Alternatively, use Docker Compose to set up the PostgreSQL database:

```bash
docker-compose up -d
```

## ğŸ“ Available Scripts

```bash
npm run dev          # Start development server with Turbopack
npm run build        # Build for production
npm run start        # Start production server
npm run lint         # Run ESLint
npm run lint:fix     # Fix ESLint errors
npm run typecheck    # Run TypeScript compiler check
npm run format:check # Check code formatting
npm run format:write # Format code with Prettier
npm run db:seed      # Seed database with dummy data
```

## ğŸ¨ Features Implemented

### Companies Management
- âœ… List all companies with pagination
- âœ… Search companies by name/description
- âœ… Filter companies by industry
- âœ… Create new company with full validation
- âœ… Edit existing company details
- âœ… Delete single company
- âœ… Bulk delete multiple companies
- âœ… Optimistic UI updates for all operations

### User Experience
- âœ… Responsive design (mobile, tablet, desktop)
- âœ… Loading skeletons during data fetching
- âœ… Toast notifications for user feedback
- âœ… Confirmation dialogs for destructive actions
- âœ… Form validation with error messages
- âœ… URL-based state management for filters

## ğŸ—ï¸ Architecture Decisions

### Caching Strategy
- Used Next.js 16's `"use cache"` directive for automatic caching
- Implemented granular cache invalidation with `cacheTag()` and `updateTag()`
- Separate cache tags for list and individual items

### State Management
- React 19's `useOptimistic` for instant UI feedback
- Server Actions for mutations (no separate API routes needed)
- URL search params for shareable filter state

### Data Flow
1. **Read Operations**: Server Component â†’ Cached Data Layer â†’ Database
2. **Write Operations**: Client Component â†’ Server Action â†’ Database â†’ Cache Invalidation â†’ Revalidation

### Component Architecture
- Server Components for data fetching
- Client Components for interactivity
- Custom hooks for complex logic
- Compound component patterns for reusability

## ğŸ”’ Type Safety

The project maintains end-to-end type safety:

- **Database â†’ Application**: Prisma generates types from schema
- **API Layer**: Type-safe functions with explicit return types
- **Forms**: Zod schemas ensure runtime validation matches types
- **Components**: Full TypeScript with strict mode enabled

## ğŸš€ Performance Optimizations

1. **Server-Side Rendering** - Initial HTML generated on server
2. **Caching** - Next.js 16 cache with tag-based invalidation
3. **Code Splitting** - Automatic route-based splitting
4. **Optimistic Updates** - Instant UI feedback
5. **Suspense Boundaries** - Progressive loading states
6. **Turbopack** - Fast development builds

## Author

Bernardo Batistelli

---
